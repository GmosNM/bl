<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-01-27 Sun 21:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Biscuit-MIR Documentation</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Martin Dorazil" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Biscuit-MIR Documentation</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1061488">About</a>
<ul>
<li><a href="#orgba84318">MIR Interpreter</a></li>
<li><a href="#org11ae9ac">Assert function in MIR</a></li>
<li><a href="#orgd38b5e5">Stack manipulation</a></li>
</ul>
</li>
<li><a href="#org7e7442d">Function</a></li>
<li><a href="#org67f69f6">Block</a></li>
<li><a href="#org7b2cca0">Instructions:</a>
<ul>
<li><a href="#org33447aa">const</a></li>
<li><a href="#org0c8eb00">decl</a></li>
<li><a href="#org6e189a7">load</a></li>
<li><a href="#org557b16b">store</a></li>
<li><a href="#orge14beb0">arg</a></li>
<li><a href="#orgef63dcf">call</a></li>
<li><a href="#orgbd606fc">ret</a></li>
<li><a href="#org7463651">br</a></li>
<li><a href="#org55759a6">br (conditional)</a></li>
<li><a href="#org2c7d760">unreachable</a></li>
<li><a href="#orgcdabaff">binop</a></li>
<li><a href="#orgd6b7829">unop</a></li>
<li><a href="#orgcea6fc3">elemptr</a></li>
<li><a href="#org08b7199">memberptr</a></li>
<li><a href="#org82eaa9f">addrof</a></li>
</ul>
</li>
<li><a href="#org230fed5">Special instructions</a>
<ul>
<li><a href="#org6c0c06d">tryinfer</a></li>
<li><a href="#orga84aea9">validate_type</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org1061488" class="outline-2">
<h2 id="org1061488">About</h2>
<div class="outline-text-2" id="text-org1061488">
<p>
BL-MIR (Biscuit Language Middle Intermediate Representation) is a simplified representation of the Biscuit Language created from AST. It is located between AST and LLVM-IR. 
</p>
</div>

<div id="outline-container-orgba84318" class="outline-3">
<h3 id="orgba84318">MIR Interpreter</h3>
<div class="outline-text-3" id="text-orgba84318">
<p>
BL Compiler has integrated interpreter for MIR. 
</p>

<ul class="org-ul">
<li>Default execution stack size is 2MB.</li>
<li>Stack allocations are 8 byte aligned.</li>
</ul>
</div>
</div>

<div id="outline-container-org11ae9ac" class="outline-3">
<h3 id="org11ae9ac">Assert function in MIR</h3>
<div class="outline-text-3" id="text-org11ae9ac">
<div class="org-src-container">
<pre class="src src-blm"><span class="org-function-name">@assert</span> fn(<span class="org-type">bool</span>) <span class="org-type">void</span> {
<span class="org-constant">init_0</span>:
  <span class="org-constant">%0</span>              *<span class="org-type">bool</span> <span class="org-keyword">decl</span> cond : <span class="org-type">bool</span>
  %1               <span class="org-type">bool</span> <span class="org-keyword">arg</span> $0
  %3               <span class="org-type">void</span> <span class="org-keyword">store</span> %1 -&gt; %0
  %11              <span class="org-type">void</span> <span class="org-keyword">br</span> entry_1

<span class="org-constant">entry_1</span>:
  %5               <span class="org-type">bool</span> <span class="org-keyword">load</span> %0
  %6               <span class="org-type">bool</span> <span class="org-keyword">unop</span> !%5
  <span class="org-constant">%7</span>               <span class="org-type">void</span> <span class="org-keyword">br</span> %6 ? if_then_2 : if_else_3

<span class="org-constant">if_then_2</span>:
  %8               <span class="org-type">void</span> <span class="org-keyword">unreachable</span>
  %9               <span class="org-type">void</span> <span class="org-keyword">br</span> if_cont_4

<span class="org-constant">if_else_3</span>:
  %10              <span class="org-type">void</span> <span class="org-keyword">br</span> if_cont_4

<span class="org-constant">if_cont_4</span>:
  %12              <span class="org-type">void</span> <span class="org-keyword">ret</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd38b5e5" class="outline-3">
<h3 id="orgd38b5e5">Stack manipulation</h3>
<div class="outline-text-3" id="text-orgd38b5e5">
<p>
Example function:
</p>
<div class="org-src-container">
<pre class="src src-bl"><span class="org-preprocessor">#load</span> <span class="org-string">"std/debug.bl"</span>
<span class="org-function-name">main</span> :: <span class="org-keyword">fn</span> () <span class="org-type">s32</span> {
  <span class="org-constant">v</span> :: <span class="org-constant">10</span>;
  <span class="org-function-name">assert</span>(v == <span class="org-constant">10</span>);
  <span class="org-keyword">return</span> <span class="org-constant">0</span>;
};
</pre>
</div>

<p>
Stack operation produced during execution of the main function:
</p>
<pre class="example">
executing 'main' in compile time...
     -             Terminal  PUSH RA
    10         InstrDeclVar  PUSH    (4B, 0x7f377a17a060) s32
    11           InstrConst  PUSH    (4B, 0x7f377a17a068) s32
    13           InstrStore  POP     (4B, 0x7f377a17a06c) s32
    15           InstrConst  PUSH    (4B, 0x7f377a17a068) s32
    17            InstrLoad  PUSH    (4B, 0x7f377a17a070) s32
    18           InstrBinop  POP     (4B, 0x7f377a17a074) s32
    18           InstrBinop  POP     (4B, 0x7f377a17a06c) s32
    18           InstrBinop  PUSH    (1B, 0x7f377a17a068) bool
    19            InstrCall  PUSH RA
    87         InstrDeclVar  PUSH    (1B, 0x7f377a17a088) bool
    88             InstrArg  PUSH    (1B, 0x7f377a17a090) bool
    90           InstrStore  POP     (1B, 0x7f377a17a097) bool
    96            InstrLoad  PUSH    (1B, 0x7f377a17a090) bool
    97            InstrUnop  POP     (1B, 0x7f377a17a097) bool
    97            InstrUnop  PUSH    (1B, 0x7f377a17a090) bool
    98          InstrCondBr  POP     (1B, 0x7f377a17a097) bool
   104             InstrRet  POP RA
   104             InstrRet  POP     (1B, 0x7f377a17a06f) bool
    20           InstrConst  PUSH    (4B, 0x7f377a17a068) s32
    21             InstrRet  POP     (4B, 0x7f377a17a06c) s32
    21             InstrRet  POP RA
execution finished with state: 0
</pre>
</div>
</div>
</div>


<div id="outline-container-org7e7442d" class="outline-2">
<h2 id="org7e7442d">Function</h2>
<div class="outline-text-2" id="text-org7e7442d">
<pre class="example">
@&lt;name&gt; &lt;T&gt; { 
  [entry block]
}
</pre>
</div>
</div>

<div id="outline-container-org67f69f6" class="outline-2">
<h2 id="org67f69f6">Block</h2>
<div class="outline-text-2" id="text-org67f69f6">
<p>
Basic block representation.
</p>

<pre class="example">
&lt;name&gt;: 
  ...
  &lt;terminal instruction&gt;
</pre>
</div>
</div>

<div id="outline-container-org7b2cca0" class="outline-2">
<h2 id="org7b2cca0">Instructions:</h2>
<div class="outline-text-2" id="text-org7b2cca0">
</div>
<div id="outline-container-org33447aa" class="outline-3">
<h3 id="org33447aa">const</h3>
<div class="outline-text-3" id="text-org33447aa">
<p>
Constant value.
</p>

<pre class="example">
&lt;T&gt; const &lt;value&gt; // yields constant value of the type T
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUSH</td>
<td class="org-left">value</td>
<td class="org-left">constant value</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org0c8eb00" class="outline-3">
<h3 id="org0c8eb00">decl</h3>
<div class="outline-text-3" id="text-org0c8eb00">
<p>
Variable declaration.
</p>

<pre class="example">
&lt;*T&gt; decl &lt;name&gt; : &lt;T&gt; // yields *T (pointer to value allocated on the stack)
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUSH</td>
<td class="org-left">-</td>
<td class="org-left">storage for the variable</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6e189a7" class="outline-3">
<h3 id="org6e189a7">load</h3>
<div class="outline-text-3" id="text-org6e189a7">
<p>
Push pointed value on the stack.
</p>

<pre class="example">
&lt;T&gt; load &lt;ptr&gt; // yields T loaded from ptr
</pre>

<p>
Source is on the stack:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">ptr</td>
<td class="org-left">pointer to source</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">value</td>
<td class="org-left">value loaded from source</td>
</tr>
</tbody>
</table>

<p>
Source is variable declaration:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUSH</td>
<td class="org-left">value</td>
<td class="org-left">value loaded from source</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org557b16b" class="outline-3">
<h3 id="org557b16b">store</h3>
<div class="outline-text-3" id="text-org557b16b">
<p>
Store value from source to destination address.
</p>

<pre class="example">
void store &lt;src&gt; -&gt; &lt;dest ptr&gt; // yields void
</pre>

<p>
Destination pointer is on the stack:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">dest ptr</td>
<td class="org-left">pointer to destination</td>
</tr>

<tr>
<td class="org-left">POP</td>
<td class="org-left">src ptr</td>
<td class="org-left">value</td>
</tr>
</tbody>
</table>

<p>
Destination pointer is declaration:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">src ptr</td>
<td class="org-left">value</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orge14beb0" class="outline-3">
<h3 id="orge14beb0">arg</h3>
<div class="outline-text-3" id="text-orge14beb0">
<p>
Load argument of the current function on the stack.
</p>

<pre class="example">
&lt;T&gt; arg $&lt;arg number&gt; // yields T
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUSH</td>
<td class="org-left">arg</td>
<td class="org-left">fn argument</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgef63dcf" class="outline-3">
<h3 id="orgef63dcf">call</h3>
<div class="outline-text-3" id="text-orgef63dcf">
<p>
Call function. This instruction will create new stack frame and switch control to the callee.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUSH</td>
<td class="org-left">arg 3</td>
<td class="org-left">push 3rd argument</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">arg 2</td>
<td class="org-left">push 2nd argument</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">arg 1</td>
<td class="org-left">push 1st argument</td>
</tr>

<tr>
<td class="org-left">PUSH RA</td>
<td class="org-left">pc, call ptr</td>
<td class="org-left">create new frame stack (push program counter and call instruction pointer)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgbd606fc" class="outline-3">
<h3 id="orgbd606fc">ret</h3>
<div class="outline-text-3" id="text-orgbd606fc">
<p>
Return value from the function and return control to the caller. This instruction terminates current basic block.
</p>

<pre class="example">
void ret [value] // yields void
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP RA</td>
<td class="org-left">-</td>
<td class="org-left">rollback the stack to return address</td>
</tr>

<tr>
<td class="org-left">POP</td>
<td class="org-left">arg 1</td>
<td class="org-left">clenup fn argument</td>
</tr>

<tr>
<td class="org-left">POP</td>
<td class="org-left">arg 2</td>
<td class="org-left">clenup fn argument</td>
</tr>

<tr>
<td class="org-left">POP</td>
<td class="org-left">arg 3</td>
<td class="org-left">clenup fn argument</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">value</td>
<td class="org-left">push call result value if there is one</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org7463651" class="outline-3">
<h3 id="org7463651">br</h3>
<div class="outline-text-3" id="text-org7463651">
<p>
Breaks to the basic block. This instruction terminates current basic block.
</p>

<pre class="example">
void br &lt;block&gt; // yields void
</pre>
</div>
</div>

<div id="outline-container-org55759a6" class="outline-3">
<h3 id="org55759a6">br (conditional)</h3>
<div class="outline-text-3" id="text-org55759a6">
<p>
Breaks into then block if the condition is true. This instruction terminates current basic block.
</p>

<pre class="example">
void br &lt;cont&gt; ? &lt;then_block&gt; : &lt;else_block&gt; // yields void
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">condition</td>
<td class="org-left">checked condition</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org2c7d760" class="outline-3">
<h3 id="org2c7d760">unreachable</h3>
<div class="outline-text-3" id="text-org2c7d760">
<p>
Abort execution when this instruction is reached.
</p>
</div>
</div>

<div id="outline-container-orgcdabaff" class="outline-3">
<h3 id="orgcdabaff">binop</h3>
<div class="outline-text-3" id="text-orgcdabaff">
<p>
Binary operation.
</p>

<pre class="example">
&lt;T&gt; binop &lt;lhs&gt; &lt;+|-|*|/|%&gt; &lt;rhs&gt; // yields result value of type T
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">lhs</td>
<td class="org-left">left-hand side of operation</td>
</tr>

<tr>
<td class="org-left">POP</td>
<td class="org-left">rhs</td>
<td class="org-left">right-hand side of operation</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">result</td>
<td class="org-left">result value of the operation</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd6b7829" class="outline-3">
<h3 id="orgd6b7829">unop</h3>
<div class="outline-text-3" id="text-orgd6b7829">
<p>
Unary operation.
</p>

<pre class="example">
&lt;T&gt; unop &lt;+|-|*|&amp;&gt; &lt;value&gt; // yields result value of type T
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">value</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">result</td>
<td class="org-left">result value of the operation</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgcea6fc3" class="outline-3">
<h3 id="orgcea6fc3">elemptr</h3>
<div class="outline-text-3" id="text-orgcea6fc3">
<p>
Evaluates address of the array element and push it on the stack.
</p>

<pre class="example">
&lt;*T&gt; elemptr &lt;arr ptr&gt;[&lt;index&gt;] // yields result address *T (elem type)
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">index</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">elem ptr</td>
<td class="org-left">Address of the array element</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org08b7199" class="outline-3">
<h3 id="org08b7199">memberptr</h3>
<div class="outline-text-3" id="text-org08b7199">
<p>
Evaluates address of member access via '.' operator.
</p>

<pre class="example">
&lt;*T&gt; memberptr &lt;target ptr&gt;.&lt;member name|order&gt; // yields result address *T (member type)
</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">POP</td>
<td class="org-left">target ptr</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUSH</td>
<td class="org-left">member ptr</td>
<td class="org-left">Address of the member</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org82eaa9f" class="outline-3">
<h3 id="org82eaa9f">addrof</h3>
<div class="outline-text-3" id="text-org82eaa9f">
<p>
Evaluates address of the variable.
</p>

<p>
Getting address of variable:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">stack op</th>
<th scope="col" class="org-left">data</th>
<th scope="col" class="org-left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUSH</td>
<td class="org-left">var ptr</td>
<td class="org-left">pointer to allocated variable</td>
</tr>
</tbody>
</table>

<p>
Skipped when address has been pushed by previous instruction (ex.: 'elemptr').
</p>
</div>
</div>
</div>

<div id="outline-container-org230fed5" class="outline-2">
<h2 id="org230fed5">Special instructions</h2>
<div class="outline-text-2" id="text-org230fed5">
<p>
Special instructions are used only during analyze pass inside the compiler.
</p>
</div>

<div id="outline-container-org6c0c06d" class="outline-3">
<h3 id="org6c0c06d">tryinfer</h3>
<div class="outline-text-3" id="text-org6c0c06d">
<p>
Assign type of the source to the destination instruction.
</p>

<pre class="example">
void tryinfer &lt;src&gt; -&gt; &lt;dest&gt; // yields void
</pre>
</div>
</div>

<div id="outline-container-orga84aea9" class="outline-3">
<h3 id="orga84aea9">validate_type</h3>
<div class="outline-text-3" id="text-orga84aea9">
<p>
Validates if the source instruction yields value of type 'type'. 
</p>

<pre class="example">
void validate_type &lt;src&gt; // yields void
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Martin Dorazil</p>
<p class="date">Created: 2019-01-27 Sun 21:50</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
