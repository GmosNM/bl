#load "libc.bl"

main : fn () s32 {
  arr s32[10];
  if (arr.count != 10) { abort(); }

  loop (i := 0; i < arr.count; i += 1) {
    arr[i] = i;
  }

  loop (i := 0; i < arr.count; i += 1) {
    printf("arr[i] = %d\n", arr[i]);
  }


  foos Foo[10];
  foos.count;

  loop (i := 0; i < foos.count; i += 1) {
    foos[i].i = i;
  }

  loop (i := 0; i < foos.count; i += 1) {
    printf("foos[i].i = %d\n", foos[i].i);
  }

  bar Bar;
  loop (i := 0; i < bar.is.count; i += 1) {
    bar.is[i] = i;
  }

  loop (i := 0; i < bar.is.count; i += 1) {
    printf("bar.is[i] = %d\n", bar.is[i]);
  }

  // check array size expressions
  B : 5;
  C : 20 + B;
  arr2 s32[(10 + 2 * 3) * 2];
  arr3 s32[200 + 1 + C];
  arr4 s32[#run get()];
  arr5 s32[1 + #run get()];

  printf("arr2.count = %d\n", arr2.count);
  printf("arr3.count = %d\n", arr3.count);
  printf("arr4.count = %d\n", arr4.count);
  printf("arr5.count = %d\n", arr5.count);
  
  return EXIT_SUCCESS;
};

Foo : struct {
  i s32
};

Bar : struct {
  is s32[32]
};

get : fn () s32 {
  return 10;
};
