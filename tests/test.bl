#import "extra/glwindow"
#import "extra/draw"

main :: fn () s32 {
    using win32;

    glwindow.init();
    defer glwindow.terminate();

    opt := glwindow.make_default_create_window_options();
    opt.title  = "My Window";
    opt.width  = 1024;
    opt.height = 768;

    window, err :: glwindow.create_window(&opt);
    if err { panic(err); }
    defer glwindow.destroy_window(window);

    gl_init();
    defer gl_terminate();

    print("Vendor:     %\n", gl_get_vendor());
    print("Renderer:   %\n", gl_get_renderer());
    print("Version:    %\n", gl_get_version());

    should_quit := false;
    loop !should_quit {
        glwindow.poll_window_events();

        loop i := 0; i < glwindow.frame_events.len; i += 1 {
            event :: &glwindow.frame_events[i];
            using glwindow.EventKind;
            switch event.kind {
                QUIT { should_quit = true; }
                MOUSE_LB_DOWN { print("Down!\n"); }
                MOUSE_LB_UP   { print("Up!\n");   }
                KEY_DOWN      {
                    if cast(u8) event.data.key_code == 'a' {
                        print("A!\n");
                    } else {
                        print("Key Down %!\n", event.data.key_code);
                    }
                }
                default;
            }
        }


        gl.ClearColor(0.f, 1.f, 1.f, 1.f);
        gl.Clear(GL_COLOR_BUFFER_BIT);
        glwindow.swap_buffers(window);
        os_sleep_ms(16);
    }

    print("DONE\n");
    return 0;
}
