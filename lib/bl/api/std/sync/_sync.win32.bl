#load "sync.bl"

#scope _SyncImpl

Mutex :: _RTL_CRITICAL_SECTION;

init :: fn (mutex: *Mutex) #inline {
    _InitializeCriticalSection(mutex);
}

terminate :: fn (mutex: *Mutex) #inline {
    _DeleteCriticalSection(mutex);
}

lock :: fn (mutex: *Mutex) #inline {
    _EnterCriticalSection(mutex);
}

try_lock :: fn (mutex: *Mutex) bool #inline {
    return _TryEnterCriticalSection(mutex) != 0;
}

unlock :: fn (mutex: *Mutex) #inline {
    _LeaveCriticalSection(mutex);
}