#import "std/test"
#import "std/buffer_allocator"

main :: fn () s32 {
    return test_run();    
}

#private

test_allocation :: fn () #test {
    using std;
    mem: [128]s32;
    buf :: buffer_allocator_make(mem);

    m, err :: allocate_memory(&buf, sizeof(s32));
    test_ok(err);
    test_not_null(m);
    test_eq(buf.used_bytes, sizeof(s32));
    free_memory(&buf, m);
}

/*
test_free :: fn () #test {
    alc: std.BufferAllocator;
    std.buffer_allocator_init(&alc, g_mem);
    free_memory(&alc, null); // should be fine!
}

test_allocation_full :: fn () #test {
    alc: std.BufferAllocator;
    std.buffer_allocator_init(&alc, g_mem);

    m :: allocate_memory(&alc, auto g_mem.len);
    test_not_null(m);
    test_eq(alc.used_bytes, auto g_mem.len);
    free_memory(&alc, m); // should be fine!
}

test_allocation_multiple :: fn () #test {
    alc: std.BufferAllocator;
    std.buffer_allocator_init(&alc, g_mem);

    arr: [..]s32;
    array_init(&arr, 0, &alc);
    defer array_terminate(&arr);

    loop i := 0; i < 10000; i += 1 {
        array_push(&arr, i);
    }
    
    loop i := 0; i < 10000; i += 1 {
        test_eq(arr[i], i);
    }
}
*/
